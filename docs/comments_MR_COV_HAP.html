<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur des commentaires</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f1f5f9;
            --border: #cbd5e1;
            --surface: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            padding: 10px;
            max-width: 1000px;
            margin: 0 auto;
            color: #334155;
        }

        h2 { color: #1e293b; margin-bottom: 6px; }

        /* Card Styling */
        .card {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 0;
        }
        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-weight: 500;
            color: #64748b;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }
        .tab-button:hover {
            color: #1e293b;
        }
        .tab-button.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            font-weight: 600;
        }
        .tab-content {
            display: none;
            padding-top: 10px;
        }
        .tab-content.active {
            display: block;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .full-width { width: 100%; }

        input[type="text"] {
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
        }
        
        input[type="text"]:focus {
            outline: 2px solid var(--primary);
            border-color: transparent;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: opacity 0.2s;
        }
        button:hover { opacity: 0.9; }
        button.outline { 
            background-color: transparent; 
            border: 1px solid var(--primary); 
            color: var(--primary); 
        }
        button.outline:hover { background-color: #f8fafc; }

        /* Checkbox Grid */
        .voc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            max-height: 800px;
            overflow-y: auto;
            margin-top: 15px;
            padding-right: 5px; 
        }

        .voc-item {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .voc-item:hover { background-color: #f8fafc; }
        
        .voc-item input { 
            margin-right: 12px; 
            width: 16px; 
            height: 16px; 
            cursor: pointer;
            accent-color: var(--primary);
        }
        
        .voc-item label { 
            cursor: pointer; 
            width: 100%; 
            user-select: none;
            font-size: 0.95rem;
        }

        /* Output Area */
        textarea {
            width: 97%;
            height: 80px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: inherit;
            margin-top: 10px;
        /*    resize: vertical;*/
            resize: none;
            font-size: 1rem;
        }

        .label-bold { font-weight: 600; display: block; margin-bottom: 8px; }
        .hint { font-size: 0.85rem; color: #64748b; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>G√©n√©rateur des commentaires pour MR en dehors de specification</h2>
    <h3>Ne pas utiliser!!! (en d√©veloppement)</h3>

    <div class="tabs card" style="padding: 0; margin-bottom: 0; border: none; box-shadow: none; border-bottom: 2px solid var(--border);">
        <button class="tab-button active" onclick="openTab('voc')">COV (Compos√©s Organiques Volatils)</button>
        <button class="tab-button" onclick="openTab('pah')">HAP (Hydrocarbures Aromatiques Polycycliques)</button>
    </div>

    <div class="tab-content-container">

        <div id="voc" class="tab-content active">
            
            <div class="card">
                <label class="label-bold">S√©lectionner les compos√©s COV :</label>
    <!--            <div class="controls">
                    <input type="text" id="searchInputVoc" placeholder="Rechercher (ex: xyl√®ne)..." onkeyup="filterList('voc')" style="flex-grow: 1;">
                    <button class="outline" onclick="selectAll('voc', true)">Tout cocher</button>
                    <button class="outline" onclick="selectAll('voc', false)">Tout d√©cocher</button>
                </div> -->
                <div class="voc-grid" id="checkboxContainerVoc">
                </div>
            </div>
        </div>

        <div id="pah" class="tab-content">

             <div class="card">
                <label class="label-bold">S√©lectionner les compos√©s HAP :</label>
                <div class="controls">
                    <input type="text" id="searchInputPah" placeholder="Rechercher (ex: pyr√®ne)..." onkeyup="filterList('pah')" style="flex-grow: 1;">
                    <button class="outline" onclick="selectAll('pah', true)">Tout cocher</button>
                    <button class="outline" onclick="selectAll('pah', false)">Tout d√©cocher</button>
                </div>
                <div class="voc-grid" id="checkboxContainerPah">
                    </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <label class="label-bold">Commentaire g√©n√©r√© :</label>
        <textarea id="resultArea" readonly></textarea>
        <div style="margin-top: 10px;">
            <button onclick="copyToClipboard()">Copier le texte</button>
        </div>
    </div>

<script>
    // --- DATA ---
    const vocData = `1,1-dichloro√©th√®ne; dichlorom√©thane; trans-1,2-dichloro√©th√®ne; 1,1-dichloro√©thane; 2,2-dichloropropane; cis-1,2-dichloro√©th√®ne; chloroforme; bromochlorom√©thane; 1,1,1-trichloro√©thane; 1,1-dichloroprop√®ne; t√©trachlorure de carbone; 1,2-dichloro√©thane; benz√®ne; trichloro√©th√®ne; 1,2-dichloropropane; bromodichlorom√©thane; dibromom√©thane; cis-1,3-dichloroprop√®ne; tolu√®ne; trans-1,3-dichloroprop√®ne; 1,1,2-trichloro√©thane; 1,3-dichloropropane; t√©trachloro√©th√®ne; dibromochlorom√©thane; 1,2-dibromo√©thane; chlorobenz√®ne; 1,1,1,2-t√©trachloro√©thane; √©thylbenz√®ne; m,p-xyl√®ne; o-xyl√®ne; styr√®ne; isopropylbenz√®ne; bromoforme; 1,1,2,2-t√©trachloro√©thane; 1,2,3-trichloropropane; n-propylbenz√®ne; bromobenz√®ne; 1,3,5-trim√©thylbenz√®ne; 2-chlorotolu√®ne; 4-chlorotolu√®ne; tert-butylbenz√®ne; 1,2,4-trim√©thylbenz√®ne; sec-butylbenz√®ne; p-isopropyltolu√®ne; 1,3-dichlorobenz√®ne; 1,4-dichlorobenz√®ne; n-butylbenz√®ne; 1,2-dichlorobenz√®ne; 1,2-dibromo-3-chloropropane; 1,2,4-trichlorobenz√®ne; hexachlorobutadi√®ne; 1,2,3-trichlorobenz√®ne`;

    const pahData = `Naphtal√®ne; 2-M√©thylnaphtal√®ne; 1-M√©thylnaphtal√®ne; 2-Chloronaphtal√®ne; 1,3-Dim√©thylnaphtal√®ne;
                    Ac√©naphtyl√®ne; Ac√©napht√®ne; 2,3,5-Trim√©thylnaphtal√®ne; Fluor√®ne; Ph√©nanthr√®ne; Anthrac√®ne; Fluoranth√®ne; Pyr√®ne;
                    Benzo[c]ph√©nanthr√®ne; Benzo[a]anthrac√®ne; Chrys√®ne; Benzo[b]fluoranth√®ne; Benzo[k]fluoranth√®ne; Benzo[j]fluoranth√®ne;
                    7,12-Dim√©thylbenzo[a]anthrac√®ne; Benzo[e]pyr√®ne; Benzo[a]pyr√®ne; P√©ryl√®ne; 3-M√©thylcholanthr√®ne; Ind√©no[1,2,3-cd]pyr√®ne;
                    Dibenzo[a,h]anthrac√®ne; Benzo[g,h,i]p√©ryl√®ne; Dibenzo[a,l]pyr√®ne; Dibenzo[a,i]pyr√®ne; Dibenzo[a,h]pyr√®ne`;
    
    
    
   // Naphtal√®ne; Ac√©naphtyl√®ne; Ac√©napht√®ne; Fluor√®ne; Ph√©nanthr√®ne; Anthrac√®ne; Fluoranth√®ne; Pyr√®ne; Benzo[a]anthrac√®ne; Chrys√®ne; Benzo[b]fluoranth√®ne; Benzo[k]fluoranth√®ne; Benzo[a]pyr√®ne; Dibenzo[a,h]anthrac√®ne; Benzo[g,h,i]p√©ryl√®ne; Ind√©no[1,2,3-cd]pyr√®ne

    // --- SETUP VARIABLES ---
    // Note: templateInput is removed from the HTML since the phrases are now fixed, 
    // but the template strings are defined here in JS.
    const resultArea = document.getElementById('resultArea');
    let activeCompoundType = 'voc'; // Tracks which type is currently active

    // PHRASE TEMPLATES (Singulier et Pluriel)
    const templates = {
        voc: {
            singular: "COV : Le mat√©riau de r√©f√©rence {liste} est hors crit√®res d'acceptabilit√©, mais aucun impact sur le r√©sultat de l'√©chantillon.",
            plural: "COV : Les mat√©riaux de r√©f√©rence {liste} sont hors crit√®res d'acceptabilit√©, mais aucun impact sur les r√©sultats de l'√©chantillon."
        },
        pah: {
            singular: "Hydrocarbures aromatiques polycycliques : Le mat√©riau de r√©f√©rence {liste} est hors crit√®res d'acceptabilit√©, mais aucun impact sur le r√©sultat de l'√©chantillon.",
            plural: "Hydrocarbures aromatiques polycycliques : Les mat√©riaux de r√©f√©rence {liste} sont hors crit√®res d'acceptabilit√©, mais aucun impact sur les r√©sultats de l'√©chantillon."
        }
    };

    // --- DATA PROCESSING FUNCTION ---
    function processData(rawData) {
        return rawData
            .split(/;/)
            .map(item => {
                let name = item.trim();
    //            name = name.replace(/[.,]$/, '');
    //            name = name.replace(/^(de |d‚Äô|d')/i, ''); 
                if(name.length > 0) {
    //                return name.charAt(0).toUpperCase() + name.slice(1);
                    return name
                }
    //            return '';
            })
    //        .filter(item => item.length > 0)
    //        .sort();
    }

    const cleanListVoc = processData(vocData);
    const cleanListPah = processData(pahData);

    // --- RENDERING FUNCTION ---
    function renderList(type, compounds) {
        const containerId = (type === 'voc') ? 'checkboxContainerVoc' : 'checkboxContainerPah';
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        compounds.forEach((compound, index) => {
            const div = document.createElement('div');
            div.className = 'voc-item';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `${type}-${index}`; 
            checkbox.value = compound;
            checkbox.addEventListener('change', generateText);

            const label = document.createElement('label');
            label.htmlFor = `${type}-${index}`;
            label.innerText = compound;

            div.appendChild(checkbox);
            div.appendChild(label);
            container.appendChild(div);
        });
    }

    // --- CORE LOGIC (GENERATION) ---

    function generateText() {
    // Liste des lettres voyelles fran√ßaises (y compris les voyelles accentu√©es)
    // C'est cette liste qui d√©termine si l'√©lision (le -> l') doit √™tre appliqu√©e.
    const VOWEL_LETTERS = ['A', 'a', '√Ä', '√†', 'E', 'e', '√â', '√©', '√à', '√®', 'I', 'i', 'O', 'o', 'U', 'u'];

    /**
     * Applique l'√©lision fran√ßaise pour le d√©terminant "le" devant un nom.
     * Si le nom commence par une voyelle (selon VOWEL_LETTERS), retourne "l'Nom",
     * sinon retourne "le Nom".
     * @param {string} name - Le nom du compos√©.
     * @returns {string} - Le nom format√© avec le d√©terminant correct ("le Nom" ou "l'Nom").
     */
    function formatCompoundName(name) {
        if (!name || name.length === 0) {
            return "le [Nom manquant]";
        }
        
        // 1. Prendre la premi√®re lettre du nom.
        const firstLetter = name[0];

        // 2. V√©rifier si cette premi√®re lettre est dans la liste des voyelles.
        //    indexOf est utilis√© pour la v√©rification simple d'inclusion dans le tableau.
        if (VOWEL_LETTERS.indexOf(firstLetter) !== -1) {
            // √âLISION : la premi√®re lettre est une voyelle.
            return `l'${name}`;
        } else {
            // PAS D'√âLISION : la premi√®re lettre est une consonne.
            return `le ${name}`;
        }
    }
    
    // 1. D√©terminer l'ensemble de compos√©s √† utiliser (uniquement ceux de l'onglet actif)
    const containerId = (activeCompoundType === 'voc') ? 'checkboxContainerVoc' : 'checkboxContainerPah';
    const checkedBoxes = Array.from(document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`));
    const values = checkedBoxes.map(cb => cb.value);
    
    if (values.length === 0) {
        resultArea.value = "";
        return;
    }

    let listString;
    let finalTemplate;
    
    // Remplacement de toutes les occurrences de 'le ${...}' par 'formatCompoundName(...)'
    // ---------------------------------------------------------------------------------

    // 2. Construire la liste (le C1, le C2... et le CN)
    if (values.length === 1) {
        // Case N=1: le C1 -> formatCompoundName(C1)
        listString = formatCompoundName(values[0]);
        finalTemplate = templates[activeCompoundType].singular;
    } else {
        // Case N >= 2: le C1, le C2, ..., et le CN
        
        // La logique complexe de construction de la liste pour N>=2 est simplifi√©e
        // en utilisant 'formatCompoundName' pour chaque √©l√©ment.

        // Re-correction pour la grammaire exacte le C1, le C2 et le C3
        if (values.length === 2) {
            // N=2: le C1 et le C2 -> formatCompoundName(C1) et formatCompoundName(C2)
            listString = `${formatCompoundName(values[0])} et ${formatCompoundName(values[1])}`;
        } else {
            // N>=3: le C1, le C2, ..., et le CN
            const initialPart = values.slice(0, -1).map(c => formatCompoundName(c)).join(', ');
            const lastCompound = formatCompoundName(values[values.length - 1]);
            listString = initialPart + ` et ${lastCompound}`;
        }

        finalTemplate = templates[activeCompoundType].plural;
    }
    
    // Cette section (anciennement les points 2 et 3) est maintenant simplifi√©e
    // et ne fait qu'assurer le formatage correct de la liste finale.
    // L'ancienne logique de gestion des virgules/nombre est conserv√©e dans le 'else' ci-dessus.
    
    // 3. Remplacer le placeholder
    const finalPhrase = finalTemplate.replace('{liste}', listString);

    resultArea.value = finalPhrase;
}
    // function generateText() {
    //     // 1. D√©terminer l'ensemble de compos√©s √† utiliser (uniquement ceux de l'onglet actif)
    //     const containerId = (activeCompoundType === 'voc') ? 'checkboxContainerVoc' : 'checkboxContainerPah';
    //     const checkedBoxes = Array.from(document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`));
    //     const values = checkedBoxes.map(cb => cb.value);
        
    //     if (values.length === 0) {
    //         resultArea.value = "";
    //         return;
    //     }

    //     let listString;
    //     let finalTemplate;
    //     // to fix le Antracene --> l'Antracene
    //     // list des lettres √† corriger: A, a, √Ä, √†, E, e, √â, √©, √à, √®, I, i, O, o, U, u


    //     // 2. Construire la liste (le C1, le C2... et le CN)
    //     if (values.length === 1) {
    //         // Case N=1: le C1
    //         listString = `le ${values[0]}`;
    //         finalTemplate = templates[activeCompoundType].singular;
    //     } else {
    //         // Case N >= 2: le C1, le C2, ..., et le CN
    //         const initialPart = values.slice(0, -1).map(c => `le ${c}`).join(', ');
    //         const lastPart = `et le ${values[values.length - 1]}`;
    //         listString = `${initialPart} et le ${values[values.length - 1]}`; // Correction pour √©viter le double "et le"
            
    //         // Correction de la liste pour N>=2
    //         const initialValues = values.slice(0, -1);
    //         if (initialValues.length > 0) {
    //              listString = initialValues.map(c => `le ${c}`).join(', ') + ` et le ${values[values.length - 1]}`;
    //         } else {
    //              listString = `et le ${values[0]}`; // Cas th√©orique N=1, mais g√©r√© plus haut
    //         }


    //         finalTemplate = templates[activeCompoundType].plural;
            
    //         // Re-correction pour la grammaire exacte le C1, le C2 et le C3
    //         if (values.length === 2) {
    //             listString = `le ${values[0]} et le ${values[1]}`;
    //         } else {
    //             const initialPart = values.slice(0, -1).map(c => `le ${c}`).join(', ');
    //             listString = initialPart + ` et le ${values[values.length - 1]}`;
    //         }

    //     }
        
    //     // Finalement, on s'assure que la liste ne commence pas par une virgule si N>=2
    //     if (values.length > 1) {
    //         listString = values.slice(0, -1).map(c => `le ${c}`).join(', ') + ` et le ${values[values.length - 1]}`;
    //         if (values.length === 2) {
    //             // Pour N=2, on veut "le C1 et le C2" (sans virgule)
    //              listString = `le ${values[0]} et le ${values[1]}`;
    //         } else {
    //             // Pour N>=3, on veut "le C1, le C2, le C3 et le C4"
    //             listString = values.slice(0, -1).map(c => `le ${c}`).join(', ') + ` et le ${values[values.length - 1]}`;
    //         }
    //     } else {
    //          listString = `le ${values[0]}`;
    //     }
        
    //     // 3. Remplacer le placeholder
    //     const finalPhrase = finalTemplate.replace('{liste}', listString);

    //     resultArea.value = finalPhrase;
    // }


    // --- UI CONTROL FUNCTIONS ---

    function openTab(tabName) {
        const tabContents = document.querySelectorAll('.tab-content');
        const tabButtons = document.querySelectorAll('.tab-button');
        
        tabContents.forEach(content => content.classList.remove('active'));
        tabButtons.forEach(button => button.classList.remove('active'));

        document.getElementById(tabName).classList.add('active');
        document.querySelector(`.tab-button[onclick="openTab('${tabName}')"]`).classList.add('active');
        
        activeCompoundType = tabName; // üëà Mise √† jour essentielle
        generateText(); 
    }

    function filterList(type) {
        const inputId = (type === 'voc') ? 'searchInputVoc' : 'searchInputPah';
        const containerId = (type === 'voc') ? 'checkboxContainerVoc' : 'checkboxContainerPah';
        
        const term = document.getElementById(inputId).value.toLowerCase();
        const items = document.querySelectorAll(`#${containerId} .voc-item`);
        
        items.forEach(item => {
            const label = item.querySelector('label').innerText.toLowerCase();
            item.style.display = label.includes(term) ? 'flex' : 'none';
        });
    }

    function selectAll(type, shouldSelect) {
        const containerId = (type === 'voc') ? 'checkboxContainerVoc' : 'checkboxContainerPah';
        const items = document.querySelectorAll(`#${containerId} .voc-item`);
        
        items.forEach(item => {
            if (item.style.display !== 'none') {
                const cb = item.querySelector('input');
                cb.checked = shouldSelect;
            }
        });
        generateText();
    }

    function copyToClipboard() {
        resultArea.select();
        document.execCommand('copy');
    }

    // --- INITIALIZATION ---
    renderList('voc', cleanListVoc);
    renderList('pah', cleanListPah);
    openTab('voc');
</script>
</body>
</html>